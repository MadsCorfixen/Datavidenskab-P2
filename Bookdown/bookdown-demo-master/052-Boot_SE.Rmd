```{r, echo=FALSE, message=FALSE}
library(mosaic)
```
<!-- # Bootstrap anvendelser -->

<!-- I dette kapitel, vil der blive undersøgt hvordan bootstrap kan anvendes i praksis. Herunder, når der skal udregnes standardfejl for en estimator, til at angive konfidensintervaller, samt hvis der skal udføres hypotesetest vha. bootstrap. Til hver anvendelse, vil der også blive givet et eksempel på dataanalyse.  -->

## Bootstrap-standardfejl 

Der vil i dette afsnit beskrives, hvordan standardfejl af en bootstrap-stikprøve udregnes. I det efterfølgende afsnit vil standardfejlen inddrages i beregningen af konfidensintervallet for en bootstrap-stikprøve. Det følgende afsnit er primært skrevet på baggrund af [@TDSBootstrap].

Standardafvigelsen for en estimator beskrives som estimatorens standardfejl. Standardfejlen er et udtryk for, hvor stor en afvigelse der er fra populationens parameter til stikprøvens estimat. Jo mindre standardfejlen er, desto mindre er afvigelsen mellem estimatet og parameteren. Som udgangspunkt vil en stikprøves estimat aldrig være lig populationens parameter, fordi der ved udtagning af en stikprøve, i hvert tilfælde vil være variabilitet. Et mål for denne variabilitet er standardfejlen.

Som eksempel vil standardfejlen for estimatet af middelværdien, $\hat{\mu}$, være $\text{se}(\hat{\mu}) = \frac{\sigma}{\sqrt{n}}$.

Når der arbejdes med data udover det teoretiske, vil standardafvigelsen for populationen, $\sigma$, altid være ukendt. Derfor bruges stikprøvens estimat for standardafvigelsen, $S$ til at beregne den estimerede standardfejl, $\hat{\text{se}}$. 

Som eksempel vil den estimerede standardfejl for estimatet af middelværdien, $\hat{\mu}$, være  $\hat{\text{se}}(\hat{\mu}) = \frac{S}{\sqrt{n}}$, hvor $S = \sum_{i=1}^{n} \frac{(x_i - \hat{\mu})^2}{n - 1}$ er stikprøvens standardafvigelse for middelværdien, og $n$ er størrelsen på stikprøven.

Såfremt en estimator er normalfordelt eller tilnærmelsesvist er normalfordelt, kan det forventes, at et estimat vil være mindre end én standardfejl fra det forventede i $68\%$ af tilfældene og mindre end to standardfejl fra i $95\%$ af tilfældene. 

Dog er dette ikke altid ligetil i virkeligheden, oftest er der ikke tilstrækkelig informationer om populationen eller fordeligen af denne. Samtidig kræver det, at der er nogle specifikke krav som er opfyldt. Disse problemer kan undgås ved at benytte bootstrap til at estimere standardfejlen, givet ved nedstående formel.

$$se(\hat{\theta}) = \sqrt{\frac{1}{B-1}\sum_{b=1}^{B}(\hat{\theta_b^*} - \bar{\theta} )^2}$$

Hvor $\hat{\theta}$ er stikprøvens estimat for den ønskede parameter, $B$ er antal bootstrap-stikprøver, $\hat\theta_b^*$ er estimatet for den $b$'te bootstrap-stikprøve og $\bar{\theta} = (\frac{1}{B}) \sum_{b=1}^{B}\hat{\theta_b^*}$, [@BootMiracle].

__Eksempel__ 

I kodetstykket nedenfor laves en tilfældig population med en standard normalfordeling. Ud fra populationen udtages en tilfældig stikprøve. Der udregnes standardfejlen for stikprøven. Derefter laves $10,000$ bootstrap-stikprøver, hvor standardfejlen for bootstrap-stikprøven udrenges.

```{r, include=FALSE}
library(boot)
```


```{r}
set.seed(11)
n <- 1000

sample_pop <- rnorm(n, mean = 0, sd = 1) # Stikprøve fra populationen
SD_sample <- sd(sample_pop) #Stikprøve standardafvigelse 
SE_sample <- SD_sample/sqrt(n) #Stikprøve standardfejl

B <- 10000 # Antal bootstrap-repetitioner

meanFunc <- function(sample_pop,i){mean(sample_pop[i])} #Estimator

Boot_sample <- boot::boot(data = sample_pop, statistic = meanFunc, R = B) #Bootstrap-stikprøver
SE_boot <- sd(Boot_sample$t) #Standardfejlen for bootstrap-stikprøver

diff_procent <- ((abs(SE_sample - SE_boot))/SE_sample) * 100 #Procentvis afvigelse
```

Fra eksemplet fås, at standardfejlen for bootstrap-stikprøven er $se(\hat{\theta})=$```r SE_boot```, hvilket approksimerer stikprøvens standardfejl på $\text{se}(\hat{\mu})=$```r SE_sample```, med en forskel i dette tilfælde på ```r round(diff_procent, 3)```$\%$.
Hvis der opstår en situation hvor der ikke er en simpel måde hvorpå det er muligt at udregne standardfejlen, kan bootstrap altså udnyttes, da en forskel på $0.3 \%$ er ubetydelig. 
