```{r, echo=FALSE, message=FALSE}
library(mosaic)
```
## Bootstrap

FIXME Sæt kilde ordentligt ind

Det følgende afsnit er baseret på [@TDSBootstrap].

Bootstrap er en resampling metode, til at genererer yderligere datasæt ud fra stikprøven, hvor målet er at udføre statistik inferens for populationens parametre. 

Når man genererer de nye datasæt, bliver der tilfældigt taget et datapunkt med tilbagelægning, som bliver indsat i det nye datasæt. Dette gentages indtil det nye datasæt har samme størrelse som stikprøven. Hvert datapunkt har lige stor sandsynlighed for at blive udvalgt, $\frac{1}{n}$, hvor $n$ er antal observationer. Hele denne process gentages $b$ antal gange,hvor man tager en _resample_ af stikprøven, som man beregner inferens på.

Fremgangsmåden for bootstrapping, er således:
Man starter med at have en stikprøve af en population, hvilken man trækker yderligere stikprøver fra, kaldet bootstrap stikprøver. På hver bootstrap stikprøve udføres statistisk inferens.
Efter $b$ gentagelser, kan man udregne standardfejlen og et konfidensinterval for denne, for stikprøven.

Nu vil der vises et eksempel på hvordan bootstrapping kan udføres:
Her er et datasæt over gennemsnitlig månedlig udgift i kroner til fastfood per hustand:

```{r}
fastfood <- c(200, 0, 100, 50, 500, 100, 0, 250, 100, 150)
hist(fastfood, breaks = 18, main="Hustandes månedlige udgifter til fastfood" ,ylab="Frekvens", xlab="Udgift i kroner")
```

Nu kan stikprøvens gennemsnitlige udgift og standardafvigelsen findes:

```{r}
mean(fastfood)
sd(fastfood)
```

Derefter kan der tages en bootstrap-stikprøve ( _resample_ ) af stikprøven. Middelværdien og standardafvigelsen udregnes for bootstrap-stikprøven:

```{r}
set.seed(1)
resample <- sample(fastfood, size = length(fastfood), replace = TRUE)
resample
mean(resample)
sd(resample)
```

Dette gøres i praksis et passende antal gange, $b$, f.eks. 10.000, hvilket gør at man får 10.000 nye estimater for bootstrap-stikprøve middelværdien:

```{r}
set.seed(1)
fastfood_boot <- replicate(10000, {
  mean(sample(fastfood, size = length(fastfood), replace = TRUE))
})
hist(fastfood_boot)
mean(fastfood_boot)
sd(fastfood_boot)
```

Et 95% konfidensinterval kan udregnes ved:
```{r}
confidence_interval <- function(fastfood_boot, interval) {
  # Standardafvigelsen af bootstrappet
  fastfood_boot_sd <- sd(fastfood_boot)
  # Bootstrap størrelsen
  n <- length(fastfood_boot)
  # Middelværdien af bootstrappet
  fastfood_boot_mean <- mean(fastfood_boot)
  # Estimeret standard fejl fra t-fordeling
  standard_error <- qt((interval+1)/2, df = n - 1) * fastfood_boot_sd / sqrt(n)
  # Konfidensintervallet som vektor
  result <- c("lower" = fastfood_boot_mean - standard_error, "upper" = fastfood_boot_mean + standard_error)
  return(result)
}
confidence_interval(fastfood_boot, 0.95)
```

Ved hjælp af bootstrapping, kan det altså siges, at det gennemsnitlige fastfood-budget for populationen, med 95% sikkerhed, ligger mellem 140,98 kr. og 146,56 kr.
Man kan altså ud fra bootstrapping udføre statistik inferens, såsom middelværdien for en population, hvor man eventuelt kun har givet en enkelt stikprøve.
