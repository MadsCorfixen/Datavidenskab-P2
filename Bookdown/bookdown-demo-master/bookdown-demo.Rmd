--- 
title: "P2 - Simulering af Data"
author: "Gruppe B2-19"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: rstudio/bookdown-demo
#description: "This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook."
---

# Introduktion

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Variabeltyper

## Kvalitative variabler

De stokastiske variabler kan opdeles i kategoriske eller kvalitative variabler. Ved en kvalitativ variabel fremgår der en enhed, som er den enhed der kategoriseres efter. Udfaldsmængden er de mulige værdier, som kan forekomme ved en undersøgelse af enheden. Dette kunne eksempelvis være nationalitet, hvor der kategoriseres efter land, hvor udfaldsmængen er landene i verden.

De kvalitative variabler er opdelt efter en nominel og ordinel skala.

Den nominale beskriver variabler, som ikke har en naturlig rangorden, og derved ikke kan rangeres. Ofte er de nominale variabler tekststrenge, men de kan også være numeriske i form af postnumre, dog vil det være meningsløst at foretage beregninger såsom middelværdi eller standardafvigelsen. Eksempler på nominale variabler er køn, hudfarve, nationalitet og hårfarve, da udfaldsmængden i enheden ikke kan rangordnes. Derved skal nominale variabler illustreres ved et cirkeldiagram, da der ikke er givet nogen skala. De udregninger, som der kan foretages på nominale variabler er andele og frekvenser, da disse kun kan skelne udfald.

De ordinale variabler er de kvalitative variabler, som kan rangeres. Eftersom udfaldsmængden er naturligt rangeret, og samtidig er kategorisk, vil det altså være en ordinal variabel. Eksempler på ordinale variabler er økonomisk status, uddannelsesgrad og karakterer. Disse variablers udfaldsmængde er altså rangeret i forhold til hinanden, da det er bedre at være i en høj indkomst fremfor en lav indkomst og ligeledes er det bedre at få karakteren 10 end karakteren 4. Ud fra observationerne kan man efterfølgende blandt andet finde medianen, kvartiler m.m.

Ønsker man at finde middelværdien skal man være lidt påpasselig, eftersom det reelt set ikke giver nogen mening på ordinale variabler. Dog er det muligt at udregne en middelværdi, hvis der er en fælles forståelse af, hvad middelværdien betyder for enheden og hvilken skala, det er udregnet på baggrund af. Når ordinale variabler illustreres, skal det gøres som et søjlediagram efter rangordenen.

[@ASTAbog s. 12-13]

## Kvantitative variabler

Kvantitative variabler er defineret ved en numerisk  værdi, hvilket gør variablerne målbar. Da en kvantitativ variabel antager en numerisk værdi, kan aritmetriske operationer udføres på variablen. På baggrund af disse simple operationer er det muligt at få informationer ud af et datasæt, der kan skabe indsigt i forhold til fokusområder, som skal undersøges yderligere. Dette er en væsentlig del af dataanalyse, således at ressourcer kan anvendes optimalt.

Et andet essentielt værktøj i dataanalyse er visualisering. På baggrund af middelværdi, varians og standardafvigelse, er det muligt at visualisere data med eksempelvis et histogram eller et boksplot.

Kvantitative variabler kan opdeles i to underkategorier, interval og ratio. Derudover kan disse underkategorier inddeles yderligere i diskrete og kontinuerte variabler. __indsæt figur__ Disse beskrives i et efterfølgende afsnit.

Variabler, der tilhører intervalkategorien, er defineret som variabler, hvor det er muligt at bestemme forskellen mellem to mængder eller to tal. Det kunne eksempelvis være forskellen på temperaturen indenfor, $20 ~^\circ C$, og udenfor, $10 ~^\circ C$.

Variabler, der tilhører ratiokategorien, er defineret som variabler, hvor det er muligt at bestemme forholdet mellem to mængder eller to tal. Det betyder, at der mellem to tal skal være et særligt forhold. Som eksempel på værdier, der tilhører ratiokategorien, kan være antal hår på hovedet, fart, temperatur målt i kelvin eller tidsforskel. Årsagen til, at temperaturer målt i kelvin, men ikke temperaturer målt i grader celsius, tilhører ratiokategorien er, at værdier i denne kategori skal have et naturligt nulpunkt.

### Diskrete variabler

En underkategori til kvantitative variabler er diskrete variabler. En variabel er diskret, hvis man kan tælle værdierne i den, som eksempelvis øjne på en terning. Enhver variabel der kan beskrives, som “antallet af…” er en diskret variabel. Værdierne i en diskret variabel er heltal, eksempelvis kan det ikke siges, at en person har 2,5 søskende.

Nominale og ordinale variabler er diskrete variabler. Det kan dog være forvirrende at kende forskel på diskrete og kontinuerte variabler, da man ofte afrunder kontinuerte variabler til heltal når man måler dem, så de bliver diskrete. Alder er ét eksempel på en afrunding af et kontinuert tal. Eksempelvis siger man typisk 21 år, når man faktisk er mellem 21 og 22 år. Grunden til, at det er vigtigt at genkende om variablen er kontinuert eller diskret, er at den viden bruges til at bestemme, hvilken statistisk metode, der skal benyttes til dataanalysen. (Kilde: [@ASTAbog])


### Kontinuerte variabler

Hvis en varibels værdier tilhører en overtællelig mængde, siges den at være kontinuert. Et eksempel på en kontinuert variabel, kan være højden på et tilfældigt menneske i en population. Her kan højden have et antal decimaler, der går mod uendeligt, for eksempel $195,00000003 cm$.

For kontinuerte variabler bruger man tæthedsfunktionen, f(x). Her er arealet, hvilket svarer til 1 altså 100 procent, under tæthedsfunktionen sandsynligheden for, at en stokastisk variabel, X, befinder sig i intervallet (a, b), givet ved,

$P(a < X < b) = \int_a^b f(x) dx$

Den typiske kontinuerte fordeling er en normalfordeling. Dels fordi den fremgår i mange målinger i virkeligheden, og dels fordi, den centrale grænseværdisætning siger, at ved et højere antal observationer, vil alle stokastiske variablers gennemsnitsfordeling antage en normalfordeling.

## Stokastiske variabler

## Outliers

En outlier kan beskrives som en observation, der afviger betydeligt fra resten af den stikprøve, observationen stammer fra (WIKI). Denne beskrivelse uddybes nedenfor, hvor to forskellige metoder til at identificere outliers gennemgås. Afsnittet er skrevet med udgangspunkt i [@ASTAbog, s. 48-55].

Den første metode til at identificere outliers tager udgangpunkt i fordelingen af observationerne. Hvis fordelingen er tilnærmelsesvis klokkeformet, gælder figur, hvor $\mu$ er middelværdien og $\sigma$ er standardafvigelse.

```{r, out.width='75%', fig.align='center', fig.cap = "Figurtekst", echo = FALSE}
knitr::include_graphics('images/Normalfordeling.PNG')
```

Det gælder altså, at $\approx 68 \%$ af observationerne findes inden for én standardafvigelse fra middelværdien, $\approx 95 \%$ inden for to standardafvigelser og $\approx 99,7 \%$ inden for tre standardafvigelser.

På baggrund af dette, kan en outlier defineres som en værdi, der ligger et vist antal standardafvigelser væk fra middelværdien. Som udgangspunkt siges det, at hvis en værdi er mere end $3$ standardafvigelser væk fra middelværdien, kan den ses som en outlier.

En anden måde at beskrive fordelingen af en observation er ved hjælp af percentiler - et punkt for hvilket en hvis mængde af data antager værdier, der ligger over eller under punktet. Her en medianen et specialtilfælde af en percentil, 50-percentilen, hvor halvdelen af data antager værdier under punktet, og den anden halvdel over punktet. Generelt defineres en percentil som,

>```{definition}
>__p-percentilen__ er et punkt, således at $p  \%$ af observationerne antager værdier under punktet, og $(100 - p) \%$ af observationerne antager værdier over punktet.
>```

To andre særlige tilfælde af percentiler er 25-percentilen, den nedre kvartil ($Q_L$), og 75-percentilen, den øvre kvartil ($Q_U$). Ved hjælp af $Q_L$ og $Q_U$ kan variabiliteten af observationerne beskrives som afstanden mellem de to kvartiler. Denne afstand benævnes _Inner Quartile Range_ (_IQR_), og beregnes som $IQR = Q_U - Q_L$.

Når både minimum, nedre kvartil, median, øvre kvartil og maksimum er fundet, kan disse benyttes til at tegne et boksplot af observationerne. Et boksplot giver et grafisk overblik af midten og variabiliteten af observationerne. Et boksplot ser ud, som på figuren nedenfor.

```{r, out.width='75%', fig.align='center', fig.cap="Figurtekst", echo = FALSE}
knitr::include_graphics('images/Boksplot.PNG')
```

På baggrund af _IQR_ og boksplottet kan outliers nu defineres som data, der antager værdier mere end $1,5(IQR)$ gange over $Q_U$ eller under $Q_L$.

Outliers er altså værdier, der er ekstreme nok til at påvirke en dataanalyse i forkert retning. Derfor benyttes forskellige metoder til at identificere sådanne outliers, som derefter kan fjernes i en rengøring af datasættet.

## Problemformulering

_Hvorvidt kan simulationsstudier bidrage til at højne kvaliteten af dataanalyser?_

1. Hvilke faldgruber skal man være opmærksom på?

2. Hvordan simulerer man data?

a. Hvordan sikrer man en høj kvalitet af simuleret data?

3. Hvad kan man inferere ud fra simuleret data?

4. Hvilke alternativer finder der til statistisk inferens? (Bootstrapping)

<!--chapter:end:01-problemanalyse.Rmd-->

# Faldgruber i en dataanalyse

Der er flere forskellige forhold at tage hensyn til, inden en dataanalyse påbegyndes. Nogle eksempler på disse forhold gennemgåes i dette kapitel, herunder variabeltyper, estimatorens egenskaber, fordelinger og antallet af kovariater. Afsnittet er primært skrevet med inspiration fra [@ASTAbog] og [@ASTAkursus3].

## Variabeltyper

I dette afsnit gennemgåes...  fordi...

Som nævnt i __AFSNITTET__, findes der forskellige typer af variable. Dette er en vigtig faktor at tage hensyn til, da det har indflydelse på, hvilke matematiske operationer, der kan udføres på variablen. Desuden har variabeltypen indflydelse på, hvilken type diagram de kan illustreres i. En kort opsummering af, hvilke operationer, der kan udføres på hvilke variable, ses på tabellen nedenfor.

Table: En oversigt over de forskellige variable, og hvilke typer af matematiske operationer, der kan udføres på dem.

|  Kvalitative variable   |      Kvantitative variable           ||
|-------------|-----------|-------------------|-------------------|
| __Nominal__ |__Ordinal__| __Interval__      | __Ratio__         |
|    Andel    |   Median  | Middelværdi       | Middelværdi       |
|   Frekvens  | Kvartiler | Standardafvigelse | Standardafvigelse |

Generelt gælder det, at hvis en variabel tillader en bestemt operation, tillades samme operation på variabler, der står til højre i tabellen.

En anden væsentlig, omend ikke lige så matematisk faldgrube, er symboler. Der defineres nøjagtigt, hvad en parameter, et estimat og en estimator er, og de hver et specifikt symbol. Generelt gælder, at græske bogstaver definerer en parameter, det tilsvarende latinske bogstav et estimat, og et stort latinsk bogstav en estimator. I tabellen nedenfor er det opsummeret, hvad fire forskellige parametre er givet som, og hvad det tilsvarende er i stikprøven og estimatoren.

Table: En oversigt over de forskellige symboler, som angiver henholdsvis en parameter, et estimat og en estimator.

| Population (Parametre) | Stikprøve (Estimater) | Estimatorer |
|:-----------:|:---------:|:---------:|
|      my     |   my_hat  |   My_hat  |
|   sigma     |     s     |     S     |
|  sigma^2    |    s^2    |    S^2    |
|      pi     |   pi_hat  |   Pi_hat  |

Det er derfor klart, at der skal være enighed om, hvad en parameter og et estimat er, og hvad forskellen er på et estimat og en estimator, før en dataanalyse kan udføres korrekt.


## Estimatorens egenskaber

I dette afsnit gennemgåes de forskellige egenskaber, unbiased, efficient, konsistent og sufficient, en estimator kan have. Disse begreber giver et indblik i, hvor god en estimator er, og derved også, hvor valide resultater, en dataanalyse på baggrund af den estimator, vil bibringe.

En estimator er en stikprøvefunktion, der udfører en beregning på baggrund af værdier i en stikprøve, for at estimere parametrene i en population. Eksempelvis er middelværdi, $mean = \frac{\sum observationer}{\# observationer}$, en estimator, der beregner et estimat for en populations middelværdi.

Der findes overordnet set fire forskellige måder at måle, hvorvidt en estimator er passende for ens data. Disse er, om estimatoren er forventningsret, efficient, konsistent og sufficient, som defineret nedenfor. 

>```{definition}
>__Estimatorers egenskaber__ [@ASTAkursus3]
>
> _Forventningsret_: Den forventede værdi for en forventningsret estimator er lig parameteren $E(\hat{Y}) = \mu$.
>
> _Efficient_: En efficient estimator er den estimator med lavest varians.
>
> _Konsistent_: Variansen af en konsistent estimator falder, når størrelsen af stikprøven stiger.
>
> _Sufficient_: For en sufficient estimator gælder det, at når estimatet er beregnet, skal stikprøven ikke indeholde yderligere informationer om parameteret.
> ```

Hver af disse egenskaber har indvirkning på, hvor brugbare resultater, en dataanalyse vil bibringe. En estimator, der ikke er forventningsret, vil ikke give et korrekt bud på populationens middelværdi. Ligeledes vil en estimator, der ikke er efficient, have en større varians end mindst en anden estimator, hvilket leder til mindre brugbare resultater. Det er derfor vigtigt, at en estimator undersøges grundigt, og dens egenskaber bestemmes, inden den tages i brug.

## Populationens fordeling

I dette afsnit gennemgåes, hvilken indflydelse en populations fordeling har på fordelingen af estimaterne og de tilhørende estimatorer. Dette er nødvendigt, da forskellige regneregler og metoder, der gælder for eksempelvis en normalfordeling ikke nødvendigvis gælder for eksempelvis en uniform fordeling.



- Population højreskæv -> estimat højreskæv og estimator højreskæv
- Generel foldningsregel
- Den centrale grænseværdisætning

>```{theorem}
>__Den Centrale Grænseværdisætning__ [@ASTAbog, s. 93].
>
> Ved tilfældig stikprøveudtagning af tilpas stor størrelse, vil fordelingen af stikprøvegennemsnittet blive tilnærmelsesvist normalfordelt.
>```





<!--chapter:end:02-faldgruber.Rmd-->

# Hvad er kovariater
Kovariater er variabler som beskriver responsvariablen. Responsvariablen er den variabel der ændre sig i forhold til de forklarende variabler (kovariater). Hvis man for eksempel vil lave en analyse af mænd og kvinders indkomst på arbejdsmarkedet, vil det give mening at tilføje en variabel der måler på arbejdserfaring, da den vil kunne antages at have en indflydelse på indkomsten. Kontrolvariablen der tilføjes som måler arbejdserfaring kaldes for en kovariat. Denne type sammenligning er kaldet "analysis of covariance". Hvis der ikke blev taget højde for, den ekstra variabel, arbejdserfaring og dermed kun ses på forholdet mellem indkomst og køn, ville den type sammenligning være "analysis of variance".

## Hvorfor og hvordan bruges det
Fordi at indflydelse kan ændre sig efter at der kontrolleres for variabler (kovariater), kan resultaterne for "analysis of covariance" og "analysis of variance" være forskellige. For eksempel med indkomsten mellem mænd og kvinder, kan det siges at mere arbejdserfaring har positiv indflydelse på indkomsten. Hvis mænd tenderer til at have mere arbejdserfaring end kvinder, vil resultatet ændre sig, afhængig af om man kontroller for variablen arbejdserfaring.

## Tilpas antal kovariater


<!--chapter:end:03-Faldgruber.Rmd-->

# Simulering af variabler

Simuleringer er generering af estimater på mulige udfald, og på den måde efterligne virkeligheden ved simulering. Formålet er derved, at generere tilfældigt estimerede værdier ud fra en model, der simulerer virkeligheden, hvilket muliggører yderligerer analyser. 

En defination på simulation er;

>A situation or event that seems real but is not real, used especially in order to help people deal with such situations or events. - Cambridge Dictonary [https://dictionary.cambridge.org/dictionary/english/simulation]

Ud fra definationen, er formålet altså ved simuleringer at efterligne virkeligheden, så de analyser der gøres på baggrund af simuleringerne, kan bruges i virkeligheden når lignende situationer opstår.
Brancher hvor simulationer er et yderst vigtigt redskab, er i motorsporten. I Formula 1, benytter holdene sig af simulatore, hvor de genskaber bilerne og derved kan teste nye dele af inden de behøver at producere dem i virkeligheden for at spare penge, så de derved kan analysere, hvad der for eksempel producere mere _down-force_ af forskellige dele, og så etablere den i stedet for, at skulle teste dem i virkeligheden. [https://careers.mercedesamgf1.com/facilities/simulator/] 

## Simulering i R

Simuleringer i R gøres ved at estimere udfald fra en fordeling, hvor der bliver genereret "tilfældige" tal. Eftersom tilfældige tal står i citationstegn, er det fordi, at der refereres til pseudo-tilfældige tal. 
Disse generede tal forekommer at være tilfældige, men er det reelt set ikke helt tilfældige. [https://en.wikipedia.org/wiki/Pseudorandom_number_generator]

Tallene er genereret ud fra et _seed_, som i R bestemmes ved set.seed("værdi"). Generere man tal ud fra samme _seed_, så vil værdierne altså være identiske.

Fordelinger som der blandt andet kan simuleres i R er normalfordelinger, binomialfordelinger og uniformefordelinger. 

En normalfordeling kan simuleres på følgende måde:
```{r}
set.seed(1)
rnorm(10, mean = 0, sd = 1)
```

Først sættes et _seed_, så man kan rekonstruere samme simulation igen. Næste linje startes med at skrive "rnorm" hvor "r" står for tilfældigt genererede tal, og "norm" for en normalfordeling. Inde i parantesene angives antallet af værdier der skal genereres, som bliver genereret ud fra en middelværdi på 0 og en standardafvigelse på 1. Eftersom middelværdien er 0 og standardafvigelsen er 1, kaldes denne normalfordeling for en standard normalfordeling eller Z-fordeling.

Ligeledes kan man simulere binomialfordelinger og uniformefordelinger:
```{r}
set.seed(1)
rbinom(10, size = 2, prob = 0.5)
```

Som før sættes et _seed_, og der skrives "r" før fordelingen der simuleres. Ligeledes er første værdi antallet af værdier der skal genereres. I binomialfordelingen er der angivet _size_, som er antallet success/faliure _(1/0)_ repetationer, hvor hvor _prob_ er sandsynligheden for success. 

```{r}
set.seed(1)
runif(10, min = 1, max = 2)
```

Uniformfordelingen er derimod angivet med en minimum og maximum-værdi, hvor der genereres værdier imellem. 

### Sample og replicate (Bootstrapping)

Derudover kan der simuleres på baggrund af observeret data. Ved at benytte _sample_ og _replicate_ fuktionerne kan der dannes nye simulationer. _Sample_ tager en stikprøve af den observerede data, hvor _replicate_ kan gentage forskellige stikprøver.
```{r}
set.seed(1)
Z_fordeling <- rnorm(1000, mean = 0, sd = 1)

mean(Z_fordeling)
```
Her eksekveres en Z-fordling af 1000 observationer hvor middelværdien, -0.01164814, printes. Denne middelværdi vil varriere afhængigt af det _seed_ der benyttes.

Dernæst kan der foretages en sample af Z_fordeling.

```{r}
set.seed(1)
Z_sample <- sample(Z_fordeling, size = 10, replace = TRUE)

Z_sample
mean(Z_sample)
```
Her fremgår der 10 værdier, som er taget fra Z_fordeling, som gemmes i Z_sample. _Replace_ gør så de værdier der tages og gemmes i Z_sample bliver lagt tilbage, og kan derved blive taget igen, så man kan få den samme værdi flere gange. 

Derefter er det muligt at gentage disse stikprøver ved brug af _replicate_
```{r}
set.seed(1)
Z_replicate <- replicate(100, {
  x <- mean(sample(Z_fordeling, size = 10, replace = TRUE))
})
Z_replicate
mean(Z_replicate)
```
Her bliver en stikprøve af Z_fordeling foretage 10x100 gange, hvorefter middelværdien på de 100 gentagelser bliver fundet. 

Det med at tage en et stort antal stikprøver af nogle observationer er også kaldet bootstrapping, hvilket forklares i [AFSNIT XXXX]

Henvises der ikke til noget er kilden: [https://bookdown.org/rdpeng/rprogdatascience/simulation.html]
__AFSNIT SLUT__


### Simulering af nominele variabler
En nominel variabel kan for eksempel være køn, en måde at simulere dette på kan være ved en binomialfordeling.
```{r}
set.seed(1)
gender <- rbinom(100, size = 1, prob = 0.5)
mean(gender)
```
Hvis kvinde er en success og mand er en failiure, så er der derved en forekomst på 48% kvinder og 52% mænd. Derved har binomialfordelingen taget 100 værdier, en gang,  hvor der har været 50% sandsynlighed for success, som har været kvinde. Da middelværdien er 0.48, betyder det så at der ud fra 100 observationer er 48 kvinder.

### Simulering af ordinale variabler
En ordinal variabel, som der kan simuleres kan være minutter det tager at løse en opgave, hvilket kan simuleres ved en uniformfordeling.

```{r, ECHO=FALSE}
library(mosaic)
```


```{r}
set.seed(1)
opgave <- as.integer(runif(100, min = 1, max = 10+1))
gf_histogram(~opgave, bins = 10)
```

### Simulering af interval variabler
En interval variabel kan for eksempel simuleres ved 
```{r}

```

### Simulering af ratio variabler
"..."
```{r}

```

Test


*Magnus*
**Kan man sige ting om en population ud fra stikprøver (inferens, hvordan og hvorfor?)**

Processen med at bruge data analyse til at sige noget om en underliggende population ud fra en stikprøve, kaldes også statistisk inferens. Ud fra denne stikprøve vil man lave statistike analyser, som man kan bruge til at fortælle om populationen. Dette er meget nyttig, da det kan være nemmere at indsamle og analysere data fra en mindre mængde og så sige noget om en større mængde, end hvis man skulle indsamle mange millioner datapunkter. 

I statistisk inferens differentier man normalt imellem to metoder, estimering og hypotesetest. 
Når man estimerer noget ud fra en population, vil man bruge stikprøven til at beskrive en ukendt del af populationen. Det kan f.ek.s være gennemsnitsindkomst af danskere, hvorved man finder et estimat $\mu^$ som bruges til at beskrive $\mu$. Dette vil være et punkt estimat, og vil oftest suppleres med at intervalestimat. Da punkt estimater i sin essesns er tilfældig (den vil ændre sig fra stikprøve til stikprøve), vil man helst undgå at støtte sig 100 procent op af dette når man skal konkludere noget om populationen, og derfor vil man helst have et interval at kunne henvise til. Her vil man finde det interval, hvor man er enten ca. 95% sikker på at $\mu$ ligger inden for.
Den anden form for statistisk inferenes, nemlig hypotesetest, bruges til at bestemme om en teori om befolkningen viser sig at være sand. Det kunne være at hypotesen er, at danskere tjener mere i gennemsnit end folk fra Sverige. Der vil også typisk opstilles en modsat hypotese, i tilfældet af at vores første hypotese, $H_0$ viser sig at være falsk. Denne modsat hypotese vil oftest blot sige det modsatte og kaldes for $H_A$.

Et alternativ til statistisk inferens er bootstrapping -> Overgang?


<!--chapter:end:0x-simuleringer.Rmd-->

`r if (knitr:::is_html_output()) '
# Bibliografi {-}
'`

<!--chapter:end:100-bibliografi.Rmd-->

