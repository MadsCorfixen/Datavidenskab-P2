```{r include=FALSE, MESSAGE = FALSE}
library(mosaic)
set.seed(29)
```

# T-test for skæve stikprøver {#t-test2}

__FIXME:__(Kilder!)

I de tilfælde hvor det ikke er muligt at overholde alle de pågældende antagelser, som beskrevet i afsnit \@ref(t-test), kan det ikke med sikkerhed antages, at resultaterne er retvisende. I dette afsnit vil det vises, hvad der kan ske, hvis stikprøverne ikke er normalfordelte, når der arbejdes med en uparret t-test.

I dette eksempel benyttes betafordelingen, se figur \@ref(fig:figurpop1), og gammafordelingen, se figur \@ref(fig:figurpop2), til at udføre en uparret t-test.

```{r figurpop1, fig.align="center", echo=FALSE, fig.cap= "Tæthedskurve for venstreskæv betafordeling, hvor alfa = 8 og beta = 2"}
x <- seq(0, 1, length.out = 100)
y <- dbeta(x, shape1 = 8, shape2 = 2)
plot(x, y, type = "l", main = "", ylab = "", xlab = "")
```

```{r figurpop2, fig.align="center", echo=FALSE, fig.cap= "Tæthedskurve for højreskæv gammafordeling, hvor alfa = 1 og beta = 2."}
x <- seq(0, 1, length.out = 100)
y <- dgamma(x, shape = 1,  rate = 2)
plot(x, y, type = "l", main = "", ylab = "", xlab = "")
```

Nulhypotesen er $H_0: \mu_1 - \mu_2 = 0$ og den alternative hypotese er $H_1 : \mu_1 - \mu_2 \neq 0$. Denne nulhypotese undersøges ved hjælp af en uparret t-test. Der udtages en stikprøve fra hver af de viste fordelinger, som der udføres to-sidet uparret t-test på, ved hjælp af den indbyggede funktion `t.test`.

```{r, tidy=TRUE}
#t.test ud fra de to stikprøver
Stik1 <- rbeta(100, 8, 2)
Stik2 <- rgamma(100, 1, 2)
t1 <- t.test(Stik1, Stik2, alternative = "two.sided", mu = 0, conf.level = 0.95)
```

Udfra t-testen fås et konfidensinterval på [```r round(t1$conf.int, 4)```]. Forskellen mellem populationernes middelværdier vil ligge i dette interval med $95\%$ sikkerhed, ifølge t-testen. Dækningsgraden af et konfidensinterval udarbejdet fra en uparret t-test kan undersøges ved at trække nye stikprøver fra populationerne, i alt $10,000$ gange, og hver gang oprette et nyt konfidensinterval. Den sande dækningsgrad er andelen af gangene, forskellen mellem populationernes middelværdier er indeholdt i konfidensintervallerne.

```{r ronni, fig.cap= "Kode test"}
#Undersøg dækningsgraden af konfidensintervallet ved udtræk af nye stikprøver.
middel1 <- 8/(8+2)
middel2 <- 1*(1/2)

sand_dif <- abs(middel1 - middel2)

res <- replicate(10000, {
  x1 <- rbeta(20, 8, 2)
  x2 <- rgamma(20, 1, 2)

  t_res <- t.test(x1, x2, alternative = "two.sided", conf.level = 0.95)

  konfinterval <- t_res$conf.int

  konfinterval[1L] <= sand_dif & konfinterval[2L] >= sand_dif
})

tf <- table(res)
tf
```

Det fremgår fra tabellen, at dækningsgraden af konfidensintervallerne er ```r tf[2]/100```$\%$. Dette stemmer ikke overens med antagelsen om, at konfidensintervallet har en dækningsgrad på $95\%$. Det kan derfor ikke antages, at en t-test på en ikke-normalfordelt stikprøve altid giver retvisende resultater.
